#+TODO: TODO DOING | DONE

* Current Notes
  
  Tower-web is terrible too. Try gotham? Bite the bullet and use rocket?
  need to actually run tests...
  Missing Validation:
  - Internal mappings fields

* Release Tasks
  
** 0.1 [30%]
  :PROPERTIES:
  :COOKIE_DATA: todo recursive
  :END:
*** Search [2/3] 
**** DONE Term Query
     CLOSED: [2019-01-11 Fri 11:43]
**** DONE Bool Query
     CLOSED: [2019-01-11 Fri 11:45]
**** DOING Respond with document information
*** APIs [3/6]
**** DONE Get Index
     CLOSED: [2019-01-11 Fri 23:15]
**** DONE Refresh API
     CLOSED: [2019-01-14 Mon 23:12]
**** DONE Get Document by ID
     CLOSED: [2019-01-21 Mon 09:35]
**** TODO Bulk API
**** TODO Cluster Health API
**** TODO Index Exists
     - tower-web doesn't support HEAD. Need to implement it there.
*** Clustering [3/7]
**** DONE Allow nodes to join without joining the master raft group
     CLOSED: [2019-01-20 Sun 11:28]
**** TODO Allocate unallocated shards when a node joins the cluster
**** DONE Detect when a node leaves the cluster
     CLOSED: [2019-01-20 Sun 10:29]
**** TODO De-allocate shard when a node leaves the cluster
**** TODO Remove inter-node polling
     - Gossip shard/index routing information
**** DONE Gossip infrastructure - Discovery
     CLOSED: [2019-01-18 Fri 08:10]
**** TODO Cache shard routing information
     - Done for indices. Need to figure out when to refresh it and do it for shard-level routing
     - Update local cache from gossips
     - Check meta layer synchronously if cache missed / was wrong
*** Indexing [1/4]
**** DONE Commit on an interval instead of per-operation
     CLOSED: [2019-01-14 Mon 08:26]
**** TODO Upsert semantics
**** TODO Create semantics
**** TODO Response format
*** Schema [1/1]
**** DONE Basic data types
     CLOSED: [2019-01-11 Fri 17:02]
     - Strings
     - Longs
     - Objects
*** Operations [0/5]
**** TODO Terraform configuration
**** TODO Deploy cluster to AWS
**** TODO Baseline perf test
**** TODO Structured logging
**** TODO Expose prometheus metrics
*** Storage [0/1]
**** TODO Raft Log Compaction
*** Polish [0/6]
**** TODO Reasonable test suite
**** TODO CI
**** TODO pre-commit script
**** TODO Figure out license
**** TODO README
**** TODO Contributor guidelines
** 0.2 [0%]
  :PROPERTIES:
  :COOKIE_DATA: todo recursive
  :END:
*** Search [0/4]
**** TODO Specify document count limit
**** TODO Sepcify document offset
**** TODO Sorting
**** TODO Aggregations
*** API [0/5]
**** TODO Multi Get
**** TODO Get Mapping
**** TODO Update index settings
**** TODO API docs
**** TODO Per-shard response information
*** Indexing [0/4]
**** TODO Partial Failure in bulk requests
**** TODO Delete
**** TODO Update?
*** Schema [0/13]
**** TODO Text
**** TODO Float
**** TODO Boolean
**** TODO Dates
**** TODO DateTimes
**** TODO Integer
**** TODO Short
**** TODO Byte
**** TODO Double
**** TODO Float
**** TODO Half Float
**** TODO Scaled Float
**** TODO Binary
*** Clustering [0/4]
**** TODO Replica sets should have a lease holder
    - https://github.com/cockroachdb/cockroach/blob/master/docs/design.md#range-leases
      https://github.com/cockroachdb/cockroach/blob/master/docs/RFCS/20160210_range_leases.md
**** TODO Direct all reads at the lease holder
**** TODO Heartbeat at the node level, not the shard level
**** TODO Remove 'node id' configuration 
     Shouldn't have to force the user to configure this, we should
     figure out node ids from address or something else
** 0.3 [0%]
  :PROPERTIES:
  :COOKIE_DATA: todo recursive
  :END:
*** Search [0/2]
**** TODO Cross-index search
*** API [0/1]
**** TODO Update mappings
**** TODO Cluster settings API
*** Indexing [/]
*** Percolation [0/1]
**** TODO Implment it
*** Schema [0/3]
**** TODO Nested Documents
**** TODO Range Types?
*** Clustering [0/3]
**** TODO Split / Merge(?)
**** TODO Auto-scale replication
* Icebox

** Tooling
*** tower-grpc is interesting, but ergonomics of pingcap's grpc are currently better. Both suck.
    
** Tantivy Issues
   - Max field count is 255
   - Threading is weird. I want to manage the thread pool across many indices
   - No way to have a user-defined doc id

** Neat Ideas
   - Avoid dirty reads!
   - Can we provide even better consistency guarantees?
   - Joins! 
     - https://www.memsql.com/blog/scaling-distributed-joins/
   - Autoscaling
     - Split shards at certain conditions
     - Add replicas at certain conditions
* Impl Notes
  Elasticsearch ids: https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/index/mapper/Uid.java#L178
